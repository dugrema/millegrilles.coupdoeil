# Stack pour stack web Coup D'Oeil de MilleGrilles
version: '3.7'

services:

  # Application Meteor pour Coup D'Oeil
  coupdoeilmeteor:
    image:  registry.maple.mdugre.info:5000/coupdoeil_meteor.x86_64:v0.10.2
    hostname: coupdoeilmeteor.maple.millegrilles.mdugre.info
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.labels.netzone.private == true
          - node.labels.millegrilles.coupdoeil == true
      resources:
       limits:
          cpus: "1.00"
          memory: 1G
      restart_policy:
        condition: any
        delay: 30s
    ports:
      - "3001:3000"
    environment:
      MG_NOM_MILLEGRILLE: maple
      MONGO_URL: mongodb://coupdoeilmeteor:higCYUD096aQUI67@mongo/mg-maple?ssl=true
      MONGO_OPLOG_URL: mongodb://coupdoeilmeteor:higCYUD096aQUI67@mongo/local?ssl=true&authSource=admin
      MG_MQ_HOST: mq
      MG_MQ_PORT: 5672
      MG_MQ_USER: coupdoeil
      MG_MQ_PASSWORD: gLOUj3xLAj82
      MG_MQ_PROTOCOL: amqp
    networks:
      - mg_net

networks:
  mg_net:
    external: true
    name: mg_net
